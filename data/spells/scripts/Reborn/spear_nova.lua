local enchSpearWaveArea = {
	
	createCombatArea({
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	}),
	
	createCombatArea({
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
	}),
	
	createCombatArea({
		{1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 2, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1},
		{1, 1, 1, 1, 1, 1, 1}
	}),

	createCombatArea({
		{1, 1, 1},
		{1, 2, 1},
		{1, 1, 1}
	})
}

local royalSpearWaveArea = {
	
	createCombatArea({
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
	}),
	
	createCombatArea({
		{1, 1, 1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 2, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 1},
		{1, 1, 1, 1, 1, 1, 1, 1, 1}
	}),
	
	createCombatArea({
		{1, 1, 1, 1, 1},
		{1, 0, 0, 0, 1},
		{1, 0, 2, 0, 1},
		{1, 0, 0, 0, 1},
		{1, 1, 1, 1, 1}
	})
}


function onTargetTile1(cid, pos)
	doSendDistanceShoot(getThingPos(cid), pos, 17)
end

function onGetFormulaValues(cid, level, skill, attack, factor)
	return -(((skill + 15) * 17) + (level * 40)), -(((skill + 15) * 17) + (level * 40))
end

local enchSpearWave = {}
for k, area in ipairs(enchSpearWaveArea) do
	enchSpearWave[k] = createCombatObject()
	setCombatParam(enchSpearWave[k], COMBAT_PARAM_TYPE, COMBAT_PHYSICALDAMAGE)
	setCombatParam(enchSpearWave[k], COMBAT_PARAM_EFFECT, 1)
 
	setCombatArea(enchSpearWave[k], area)
 
	_G["callback1" .. k] = onTargetTile1
	setCombatCallback(enchSpearWave[k], CALLBACK_PARAM_TARGETTILE, "callback1" .. k)
	
	_G["callback2" .. k] = onGetFormulaValues
	setCombatCallback(enchSpearWave[k], CALLBACK_PARAM_SKILLVALUE, "callback2" .. k)
end
 
function onTargetTile2(cid, pos)
	doSendDistanceShoot(getThingPos(cid), pos, 20)
end

local royalSpearWave = {}
for k, area in ipairs(royalSpearWaveArea) do
	royalSpearWave[k] = createCombatObject()
	setCombatParam(royalSpearWave[k], COMBAT_PARAM_TYPE, COMBAT_PHYSICALDAMAGE)
	setCombatParam(royalSpearWave[k], COMBAT_PARAM_EFFECT, 20)
 
	setCombatArea(royalSpearWave[k], area)
 
	_G["callback3" .. k] = onTargetTile2
	setCombatCallback(royalSpearWave[k], CALLBACK_PARAM_TARGETTILE, "callback3" .. k)
	
	_G["callback4" .. k] = onGetFormulaValues
	setCombatCallback(royalSpearWave[k], CALLBACK_PARAM_SKILLVALUE, "callback4" .. k)
end

local function castSpellDelay(p)
	doCombat(unpack(p))
end

function onCastSpell(cid, var)
	for k, area in ipairs(enchSpearWave) do
		addEvent(castSpellDelay, 1000 * k, {cid, enchSpearWave[k], var})
	end
	
	for k, area in ipairs(royalSpearWave) do
		addEvent(castSpellDelay, 1000 * k + 500, {cid, royalSpearWave[k], var})
	end
	return LUA_NO_ERROR
end